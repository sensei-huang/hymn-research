let scrollPosition,scrollDecimal,scrollID,tune,lyrics,lines,wakeLock=null,autoScrollOn=0,scrollSpeed=.1,firstChorus=-1,firstChorusEnd=-1,chorusChords=[],stanzaChords=[];async function changeWake(a){a.checked?await lockScreen():await unlockScreen()}async function lockScreen(){try{wakeLock=await navigator.wakeLock.request("screen"),wakeLock.onrelease=function(){wakeLock=null,document.getElementById("wakebox").checked=!1}}catch(a){console.error("Failed to enable screen lock: "+a.name+", "+a.message)}}async function unlockScreen(){try{null!==wakeLock&&(await wakeLock.release(),wakeLock=null)}catch(a){console.error("Failed to disable screen lock: "+a.name+", "+a.message)}}function addAutoScrollSpeed(){let a=document.createElement("div");a.className="navbar",a.innerHTML="<span>Scroll speed:</span><button class=\"plusminus\" onclick='scrollSpeed-=.01,document.getElementById(\"speedDisplay\").innerText=(10*scrollSpeed).toFixed(1)'><svg class=\"plusminusSVG\" viewBox=\"0 0 20 20\"><path d=\"M2 9h16v3H2z\"></path></svg></button><span id=\"speedDisplay\">1.0</span><button class=\"plusminus\" onclick='scrollSpeed+=.01,document.getElementById(\"speedDisplay\").innerText=(10*scrollSpeed).toFixed(1)'><svg class=\"plusminusSVG\" viewBox=\"0 0 20 20\"><path d=\"M9 11v7h3v-7h7V8h-7V1H9v7H2v3z\"></path></svg></button><button class=\"button\" onclick=\"removeAutoScrollSpeed()\">Stop</button>",document.getElementsByClassName("song-app")[0].append(a)}function removeAutoScrollSpeed(){document.getElementsByClassName("navbar")[0].remove(),cancelAnimationFrame(scrollID),autoScrollOn=0}function addButtons(){let a=document.createElement("style");a.innerHTML=".switch{position:relative;width:45px;height:26px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:26px}.slider:before{position:absolute;content:\"\";height:20px;width:20px;left:3px;bottom:3px;background-color:#fff;transition:.4s;border-radius:50%}input:checked + .slider{background-color:#2196F3}input:checked + .slider:before{transform:translateX(19px)}.interactive-container{display:flex;justify-content:center;align-items:center;user-select:none;color:#aaa}.button{background-color:#ccc;border:none;color:#fff;padding:5px 7px;text-align:center;cursor:pointer;border-radius:9px;display:block}.button:hover{transform:scale(1.05);transition:all .3s cubic-bezier(0.05,0.83,0.43,0.96)}.button:active{background-color:#aaa}.navbar{user-select:none;width:100%;position:fixed;bottom:0;left:0;display:flex;justify-content:center;align-items:center;background-color:#ddd;opacity:95%}.plusminus{margin:4px;position:relative;background-color:#fff;border:2px solid #ccc;width:25px;height:25px;cursor:pointer;border-radius:50%}.plusminusSVG{display:flex;align-items:center;justify-content:center;position:absolute;margin:2px;top:0;left:0;fill:#ccc}",document.head.appendChild(a);let b=document.getElementsByClassName("song-app")[0],c=document.createElement("div");c.className="interactive-container",b.insertBefore(c,document.getElementsByClassName("home-title")[0].nextSibling);let d=document.createElement("label");d.className="switch",d.innerHTML="<input type=\"checkbox\" onclick=\"changeWake(this);\" id=\"wakebox\"><span class=\"slider\"></span>",c.append(d);let e=document.createElement("span");e.innerText="Singing mode (keeps screen awake)",e.style="margin-left: 10px;",c.append(e);let f=document.createElement("div");f.className="interactive-container",f.style="justify-content: space-between;",b.insertBefore(f,c.nextSibling);let g=document.createElement("button");g.innerText="Add chords",g.className="button",g.style="margin: 3px 0px 2px 50px;",g.onclick=function(){processSong(),updateSong()},f.append(g);let h=document.createElement("button");h.innerText="Autoscroll",h.className="button",h.style="margin: 3px 50px 2px 0px;",h.onclick=function(){0==autoScrollOn&&(autoScrollOn=1,scrollPosition=window.scrollY,scrollDecimal=0,scrollID=requestAnimationFrame(autoScroll),addAutoScrollSpeed())},f.append(h)}function autoScroll(){scrollPosition=window.scrollY+scrollSpeed+scrollDecimal,scrollDecimal=scrollPosition-Math.round(scrollPosition),scrollPosition=Math.round(scrollPosition),window.scrollTo(0,scrollPosition),scrollPosition<document.documentElement.scrollHeight-document.documentElement.clientHeight?scrollID=requestAnimationFrame(autoScroll):removeAutoScrollSpeed()}function extractChordLine(a){let b=[],d="";for(let e=0;e<lines[a].length;e++)if("["===lines[a][e]){let c=syl(d);e++;let f="";for(;"]"!==lines[a][e];)f+=lines[a][e],e++;b.push([f,c])}else d+=lines[a][e];return b}function extractChords(a){let b=[];for(;""!==lines[a]&&!/^#.*/.test(lines[a])&&a<lines.length;)b.push(extractChordLine(a)),a++;return[a,b]}function readTune(a){if("  "===lines[a].substring(0,2)){if(-1==firstChorus&&(firstChorus=a),lines[a].includes("[")){if(firstChorus==a){let b=extractChords(a);a=b[0],chorusChords=b[1],firstChorusEnd=a}else{let b=extractChords(a);a=b[0],chorusChords=b[1]}}else if(firstChorus==a){for(;""!==lines[a]&&!/^#.*/.test(lines[a])&&a<lines.length;)a++;firstChorusEnd=a}else for(;""!==lines[a]&&!/^#.*/.test(lines[a])&&a<lines.length;)a++;}else if(/^([0-9]+)$/.test(lines[a]))if(a++,lines[a].includes("[")){let b=extractChords(a);a=b[0],stanzaChords=b[1]}else for(;""!==lines[a]&&!/^#.*/.test(lines[a])&&a<lines.length;)a++;return a}function placeChordLine(b,d){let e="",f=0;for(let c,g=0;g<d.length;g++){for(c=syl(e);c<d[g][1]&&f<lines[b].length;)e+=lines[b][f],c=syl(e),f++;if(f==lines[b].length){for(;g<d.length;)lines[b]+="["+d[g][0]+"]",g++;break}0==f?(f++,"  "===lines[b].substring(0,2)?(f+=2,lines[b]=lines[b].slice(0,f-1)+"["+d[g][0]+"]"+lines[b].slice(f-1)):lines[b]="["+d[g][0]+"]"+lines[b]):lines[b]=lines[b].slice(0,f-1)+"["+d[g][0]+"]"+lines[b].slice(f-1),f+=d[g][0].length+2}}function placeChords(a,b){for(let c=a;""!==lines[a]&&!/^#.*/.test(lines[a])&&a<lines.length;)placeChordLine(a,b[a-c]),a++;return a}function writeTune(a){if("  "===lines[a].substring(0,2))lines[a].includes("[")||(a=placeChords(a,chorusChords));else if(/^([0-9]+)$/.test(lines[a])){if(a++,!lines[a].includes("["))a=placeChords(a,stanzaChords);else for(;""!==lines[a]&&!/^#.*/.test(lines[a])&&a<lines.length;)a++;if(a--,-1<firstChorusEnd&&a>firstChorusEnd){for(a++;(""==lines[a]||/^#.*/.test(lines[a]))&&a<lines.length;)a++;if(a==lines.length){for(""!=lines[lines.length-1]&&(lines.splice(a,0,""),a++),j=firstChorusEnd-1;j>=firstChorus;j--)lines.splice(a,0,lines[j]);a+=firstChorusEnd-firstChorus}else if("  "!==lines[a].substring(0,2)){for(j=firstChorusEnd-1;j>=firstChorus;j--)lines.splice(a,0,lines[j]);a+=firstChorusEnd-firstChorus,lines.splice(a,0,"")}}}return a}function processSong(){tune=+song.state.selectedTune,lyrics=song.lyricArray()[tune],lines=lyrics.split("\n");for(let a=0;a<lines.length;a++)a=readTune(a);for(let a=0;a<lines.length;a++)a=writeTune(a)}function updateSong(){let a=song.lyricArray(),b="";for(let c=0;c<a.length;c++)b+=c==tune?lines.join("\n"):a[c];song.props.lyrics=b,song.forceUpdate()}let js=document.createElement("script");js.type="module",js.innerHTML="import{syllable}from\"https://esm.sh/syllable@5?bundle\";import syllables from\"https://esm.sh/syllables@2.2.1?bundle\";window.syl=function(a){return /(^|\\s)[wW]$/.test(a)?syllables(a,{fallbackSyllablesFunction:syllable})-2:syllables(a,{fallbackSyllablesFunction:syllable})},addButtons();",document.head.appendChild(js),window.addEventListener("scroll",a=>{"index"!=$app.state.page&&a.stopImmediatePropagation()},!0);
