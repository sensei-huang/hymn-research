let scrollPosition,scrollDecimal,scrollID,tune,lyrics,lines,wakeLock=null,autoScrollOn=0,scrollSpeed=.1,zoomFactor=1,chorusWritten=-1,chorusAlternate=-1,chorusChordsWritten=-1,chorusChordsAlternate=-1,stanzaWritten=-1,stanzaAlternate=-1,chorusChords=[],stanzaChords=[];async function changeWake(e){e.checked?await lockScreen():await unlockScreen()}async function lockScreen(){try{wakeLock=await navigator.wakeLock.request("screen"),wakeLock.onrelease=function(){wakeLock=null,document.getElementById("wakebox").checked=!1}}catch(e){console.error("Failed to enable screen lock: "+e.name+", "+e.message)}}async function unlockScreen(){try{null!==wakeLock&&(await wakeLock.release(),wakeLock=null)}catch(e){console.error("Failed to disable screen lock: "+e.name+", "+e.message)}}function addAutoScrollSpeed(){let e=document.createElement("div");e.className="navbar",e.innerHTML='<span>Scroll speed:</span><button class="plusminus"onclick=\'scrollSpeed-=.01,document.getElementById("speedDisplay").innerText=(10*scrollSpeed).toFixed(1)\'><svg class="plusminusSVG"height="17px"viewBox="0 0 20 20"width="17px"><path d="M2 9h16v3H2z"></path></svg></button><span id="speedDisplay">1.0</span><button class="plusminus"onclick=\'scrollSpeed+=.01,document.getElementById("speedDisplay").innerText=(10*scrollSpeed).toFixed(1)\'><svg class="plusminusSVG"height="17px"viewBox="0 0 20 20"width="17px"><path d="M9 11v7h3v-7h7V8h-7V1H9v7H2v3z"></path></svg></button><button class="button"onclick="removeAutoScrollSpeed()">Stop</button>',document.getElementsByClassName("song-app")[0].append(e),windowScroll=document.documentElement.scrollHeight-document.documentElement.clientHeight}function removeAutoScrollSpeed(){document.getElementsByClassName("navbar")[0].remove(),cancelAnimationFrame(scrollID),autoScrollOn=0}function addButtons(){let e=document.createElement("style");e.innerHTML='.switch{position:relative;width:45px;height:26px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:26px}.slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background-color:#fff;transition:.4s;border-radius:50%}input:checked + .slider{background-color:#2196F3}input:checked + .slider:before{transform:translateX(19px)}.interactive-container{display:flex;justify-content:center;align-items:center;user-select:none;color:#aaa}.button{background-color:#ccc;border:none;color:#fff;padding:5px 7px;text-align:center;cursor:pointer;border-radius:9px;display:block}.button:hover{transform:scale(1.05);transition:all .3s cubic-bezier(0.05,0.83,0.43,0.96)}.button:active{background-color:#aaa}.navbar{user-select:none;width:100%;position:fixed;bottom:0;left:0;display:flex;justify-content:center;align-items:center;background-color:#ddd;opacity:95%}.plusminus{margin:4px;position:relative;background-color:#fff;border:2px solid #ccc;width:25px;height:25px;cursor:pointer;border-radius:50%}.plusminusSVG{display:flex;align-items:center;justify-content:center;position:absolute;margin:2px;top:0;left:0;fill:#ccc}',document.head.appendChild(e);let t=document.getElementsByClassName("song-app")[0],n=document.createElement("div");n.className="interactive-container",t.insertBefore(n,document.getElementsByClassName("home-title")[0].nextSibling);let s=document.createElement("label");s.className="switch",s.innerHTML='<input type="checkbox" onclick="changeWake(this);" id="wakebox"><span class="slider"></span>',n.append(s);let o=document.createElement("span");o.innerText="Singing mode (keeps screen awake)",o.style="margin-left: 10px;",n.append(o);let l=document.createElement("div");l.className="interactive-container",l.style="justify-content: space-between;",t.insertBefore(l,n.nextSibling);let r=document.createElement("button");r.innerText="Add chords",r.className="button",r.style="margin: 3px 0px 2px 50px;",r.onclick=function(){processSong(),updateSong()},l.append(r);let c=document.createElement("button");c.innerText="Autoscroll",c.className="button",c.style="margin: 3px 50px 2px 0px;",c.onclick=function(){0==autoScrollOn?(autoScrollOn=1,scrollPosition=window.scrollY,scrollDecimal=0,scrollID=requestAnimationFrame(autoScroll),addAutoScrollSpeed()):removeAutoScrollSpeed()},l.append(c);let i=document.createElement("div");i.className="interactive-container",i.style="justify-content: center;",i.innerHTML='<span>Zoom:</span><button class="plusminus"onclick=\'zoomFactor-=.1,document.body.style.zoom=zoomFactor,document.getElementById("zoomDisplay").innerText=zoomFactor.toFixed(1)\'><svg class="plusminusSVG"height="17px"viewBox="0 0 20 20"width="17px"><path d="M2 9h16v3H2z"></path></svg></button><span id="zoomDisplay">1.0</span><button class="plusminus"onclick=\'zoomFactor+=.1,document.body.style.zoom=zoomFactor,document.getElementById("zoomDisplay").innerText=zoomFactor.toFixed(1)\'><svg class="plusminusSVG"height="17px"viewBox="0 0 20 20"width="17px"><path d="M9 11v7h3v-7h7V8h-7V1H9v7H2v3z"></path></svg></button><button class="button"onclick=\'zoomFactor=1,document.body.style.zoom=zoomFactor,document.getElementById("zoomDisplay").innerText=zoomFactor.toFixed(1)\'>Reset</button>',t.insertBefore(i,l.nextSibling)}function autoScroll(){scrollPosition=window.scrollY+scrollSpeed+scrollDecimal,scrollDecimal=scrollPosition-Math.round(scrollPosition),scrollPosition=Math.round(scrollPosition),window.scrollTo(window.scrollX,scrollPosition),document.getElementsByClassName("song-reference-toggle")[0].getBoundingClientRect().bottom>window.innerHeight-5?scrollID=requestAnimationFrame(autoScroll):removeAutoScrollSpeed()}function extractChordLine(e){let t=[],n="";for(let s=0;s<lines[e].length;s++)if("["===lines[e][s]){let o,l=syl(n),r="",c=-1,i=-1;for(let t=0;t<lines[e].length;t++)if("["===lines[e][t])for(;"]"!==lines[e][t];)t++;else{/[\w\s]/.test(lines[e][t])&&(r+=lines[e][t]);let n=syl(r);if(n==l&&-1==c)c=r.length;else if(n==l+1&&-1==i){i=r.length;break}}-1==c?(c=r.length,i=r.length,o=0):-1==i?(i=r.length,o=(n.length-c)/(i-c)):o=(n.length-c)/(i-c),s++;let a="";for(;"]"!==lines[e][s];)a+=lines[e][s],s++;t.push([a,l,o])}else/[\w\s]/.test(lines[e][s])&&(n+=lines[e][s]);return t}function placeChordLine(e,t){let n="",s=0;for(let o,l=0;l<t.length;l++){for(o=syl(n);o<t[l][1]&&s<lines[e].length;)/[\w\s]/.test(lines[e][s])&&(n+=lines[e][s]),o=syl(n),s++;let r=n,c=s;for(;o<t[l][1]+1&&c<lines[e].length;)/[\w\s]/.test(lines[e][c])&&(r+=lines[e][c]),o=syl(r),c++;for(let o=s+Math.round((r.length-n.length)*t[l][2]);s<o;)/[\w\s]/.test(lines[e][s])&&(n+=lines[e][s]),s++;if(s>=lines[e].length){for(;l<t.length;)lines[e]+="["+t[l][0]+"]",l++;break}lines[e]=0==s?"["+t[l][0]+"]"+lines[e]:lines[e].slice(0,s)+"["+t[l][0]+"]"+lines[e].slice(s),s+=t[l][0].length+2}}function extractChords(e){let t=[];for(;""!==lines[e]&&!/^#.*/.test(lines[e])&&e<lines.length;)t.push(extractChordLine(e)),e++;return[e,t]}function placeChords(e,t){for(let n=e;""!==lines[e]&&!/^#.*/.test(lines[e])&&e<lines.length;)e-n<t.length&&placeChordLine(e,t[e-n]),e++;return e}function processBlock(e){if("  "===lines[e].substring(0,2))if(lines[e].includes("[")){let t=e,n=extractChords(e);e=n[0],chorusChords.push([n[1],t,e]),-1!=chorusChordsAlternate&&(chorusChordsAlternate=-1)}else if(0<chorusChords.length){-1==chorusChordsWritten&&(chorusChordsWritten=1,1<chorusChords.length&&(chorusChordsAlternate=0));let t=e;-1==chorusChordsAlternate?(e=placeChords(e,chorusChords[chorusChords.length-1][0]),chorusChords.push([chorusChords[chorusChords.length-1][0],t,e])):(e=placeChords(e,chorusChords[chorusChordsAlternate][0]),chorusChords.push([chorusChords[chorusChordsAlternate][0],t,e]),chorusChordsAlternate=(chorusChordsAlternate+1)%chorusChords.length)}else for(;""!==lines[e]&&!/^#.*/.test(lines[e])&&e<lines.length;)e++;else if(/^([0-9]+)$/.test(lines[e])){if(e++,lines[e].includes("[")){let t=extractChords(e);e=t[0],stanzaChords.push(t[1])}else if(0<stanzaChords.length)-1==stanzaWritten&&(stanzaWritten=1,1<stanzaChords.length&&(stanzaAlternate=0)),-1==stanzaAlternate?e=placeChords(e,stanzaChords[stanzaChords.length-1]):(e=placeChords(e,stanzaChords[stanzaAlternate]),stanzaAlternate=(stanzaAlternate+1)%stanzaChords.length);else for(;""!==lines[e]&&!/^#.*/.test(lines[e])&&e<lines.length;)e++;for(;(""==lines[e]||/^#.*/.test(lines[e]))&&e<lines.length;)e++;if(0<chorusChords.length&&(e==lines.length||"  "!==lines[e].substring(0,2))){let t,n;if(-1==chorusWritten&&(chorusWritten=1,1<chorusChords.length&&(chorusAlternate=0)),-1==chorusAlternate?(t=chorusChords[chorusChords.length-1][1],n=chorusChords[chorusChords.length-1][2]):(t=chorusChords[chorusAlternate][1],n=chorusChords[chorusAlternate][2],chorusAlternate=(chorusAlternate+1)%chorusChords.length),e==lines.length&&""!=lines[lines.length-1]&&(lines.splice(e,0,""),e++),e==lines.length||"  "!==lines[e].substring(0,2)){for(j=n-1;j>=t;j--)lines.splice(e,0,lines[j]);e+=n-t,lines.splice(e,0,"")}}else e--}return e}function processSong(){tune=+song.state.selectedTune,lyrics=song.lyricArray()[tune],lines=lyrics.split("\n"),chorusWritten=-1,chorusAlternate=-1,chorusChordsWritten=-1,chorusChordsAlternate=-1,stanzaWritten=-1,stanzaAlternate=-1,chorusChords=[],stanzaChords=[];for(let e=0;e<lines.length;)e=processBlock(e),e++}function updateSong(){let e=song.lyricArray(),t="";for(let n=0;n<e.length;n++)t+=n==tune?lines.join("\n"):e[n];song.props.lyrics=t,song.forceUpdate()}let js=document.createElement("script");js.type="module",js.innerHTML='import{syllable}from"https://cdn.jsdelivr.net/npm/syllable@5/+esm";import syllables from"https://cdn.jsdelivr.net/npm/syllables@2.2.1/+esm";window.syl=function(a){return /(^|\\s)[^\\s]{1,2}$/.test(a)?syllables(a.replace(/[^\\s]{1,2}$/,""),{fallbackSyllablesFunction:syllable})+1:/(^|\\s)[wW]$/.test(a)?syllables(a,{fallbackSyllablesFunction:syllable})-2:syllables(a,{fallbackSyllablesFunction:syllable})},addButtons();',document.head.appendChild(js),window.addEventListener("scroll",(e=>{"index"!=$app.state.page&&e.stopImmediatePropagation()}),!0);